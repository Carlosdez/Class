<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Matemática Financiera</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        h1 {
            margin: 0;
        }
        
        .container {
            display: flex;
            gap: 20px;
        }
        
        .menu {
            flex: 1;
            background-color: white;
            border-radius: 5px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .content {
            flex: 3;
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #e8f4fc;
            border-radius: 4px;
            border-left: 4px solid #3498db;
        }
        
        .formula {
            font-family: monospace;
            background-color: #f0f0f0;
            padding: 2px 5px;
            border-radius: 3px;
        }
        
        .menu-item {
            padding: 10px;
            margin-bottom: 5px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .menu-item:hover {
            background-color: #f0f0f0;
        }
        
        .menu-item.active {
            background-color: #3498db;
            color: white;
        }
        
        .hidden {
            display: none;
        }
        
        .explanation {
            margin-top: 20px;
            font-size: 0.9em;
            color: #666;
        }
        
        .payment-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .payment-row input {
            flex: 1;
        }
        
        .add-payment {
            margin-top: 10px;
            background-color: #27ae60;
        }
        
        .add-payment:hover {
            background-color: #219653;
        }
        
        .remove-payment {
            background-color: #e74c3c;
        }
        
        .remove-payment:hover {
            background-color: #c0392b;
        }
        
        .payment-container {
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Calculadora de Matemática Financiera Mejorada</h1>
        <p>Herramienta profesional para cálculos financieros con nuevas funcionalidades</p>
    </header>
    
    <div class="container">
        <div class="menu">
            <h3>Menú de Fórmulas</h3>
            <div class="menu-item active" data-form="interes-simple">Interés Simple</div>
            <div class="menu-item" data-form="monto-interes-simple">Monto con Interés Simple</div>
            <div class="menu-item" data-form="interes-compuesto">Interés Compuesto</div>
            <div class="menu-item" data-form="monto-interes-compuesto">Monto con Interés Compuesto</div>
            <div class="menu-item" data-form="capital-interes-compuesto">Capital con Interés Compuesto</div>
            <div class="menu-item" data-form="tasa-interes-compuesto">Tasa de Interés Compuesto</div>
            <div class="menu-item" data-form="tiempo-interes-compuesto">Tiempo con Interés Compuesto</div>
            <div class="menu-item" data-form="descuento-simple">Descuento Simple</div>
            <div class="menu-item" data-form="tasa-descuento">Tasa de Descuento</div>
            <div class="menu-item" data-form="valor-presente">Valor Presente</div>
            <div class="menu-item" data-form="valor-futuro">Valor Futuro</div>
            <div class="menu-item" data-form="ecuacion-valor">Ecuación de Valor</div>
            <div class="menu-item" data-form="pagos-parciales">Pagos Parciales</div>
            <div class="menu-item" data-form="regla-saldos">Regla de Saldos</div>
        </div>
        
        <div class="content">
            <!-- Interés Simple -->
            <div id="interes-simple-form" class="form-content">
                <h2>Interés Simple</h2>
                <p class="formula">I = P × i × t</p>
                <div class="form-group">
                    <label for="is-capital">Capital (P):</label>
                    <input type="number" id="is-capital" step="0.01">
                </div>
                <div class="form-group">
                    <label for="is-tasa">Tasa de interés anual (i):</label>
                    <input type="number" id="is-tasa" step="0.0001">
                </div>
                <div class="form-group">
                    <label for="is-tiempo">Tiempo (t):</label>
                    <input type="number" id="is-tiempo" step="0.01">
                </div>
                <div class="form-group">
                    <label for="is-tiempo-unidad">Unidad de tiempo:</label>
                    <select id="is-tiempo-unidad">
                        <option value="anios">Años</option>
                        <option value="meses">Meses</option>
                        <option value="dias">Días</option>
                    </select>
                </div>
                <button onclick="calcularInteresSimple()">Calcular Interés</button>
                <div id="is-result" class="result hidden"></div>
                <div class="explanation">
                    <p>El interés simple se calcula multiplicando el capital por la tasa de interés y por el tiempo.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>I = Interés</li>
                        <li>P = Capital inicial</li>
                        <li>i = Tasa de interés anual (en decimal)</li>
                        <li>t = Tiempo (convertido a años para el cálculo)</li>
                    </ul>
                </div>
            </div>
            
            <!-- Monto con Interés Simple -->
            <div id="monto-interes-simple-form" class="form-content hidden">
                <h2>Monto con Interés Simple</h2>
                <p class="formula">M = P × (1 + i × t)</p>
                <div class="form-group">
                    <label for="mis-capital">Capital (P):</label>
                    <input type="number" id="mis-capital" step="0.01">
                </div>
                <div class="form-group">
                    <label for="mis-tasa">Tasa de interés anual (i):</label>
                    <input type="number" id="mis-tasa" step="0.0001">
                </div>
                <div class="form-group">
                    <label for="mis-tiempo">Tiempo (t):</label>
                    <input type="number" id="mis-tiempo" step="0.01">
                </div>
                <div class="form-group">
                    <label for="mis-tiempo-unidad">Unidad de tiempo:</label>
                    <select id="mis-tiempo-unidad">
                        <option value="anios">Años</option>
                        <option value="meses">Meses</option>
                        <option value="dias">Días</option>
                    </select>
                </div>
                <button onclick="calcularMontoInteresSimple()">Calcular Monto</button>
                <div id="mis-result" class="result hidden"></div>
                <div class="explanation">
                    <p>El monto con interés simple es la suma del capital inicial más los intereses generados.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>M = Monto final</li>
                        <li>P = Capital inicial</li>
                        <li>i = Tasa de interés anual (en decimal)</li>
                        <li>t = Tiempo (convertido a años para el cálculo)</li>
                    </ul>
                </div>
            </div>
            
            <!-- Interés Compuesto -->
            <div id="interes-compuesto-form" class="form-content hidden">
                <h2>Interés Compuesto</h2>
                <p class="formula">I = P × [(1 + i)<sup>n</sup> - 1]</p>
                <div class="form-group">
                    <label for="ic-capital">Capital (P):</label>
                    <input type="number" id="ic-capital" step="0.01">
                </div>
                <div class="form-group">
                    <label for="ic-tasa">Tasa de interés por período (i):</label>
                    <input type="number" id="ic-tasa" step="0.0001">
                </div>
                <div class="form-group">
                    <label for="ic-periodos">Número de períodos (n):</label>
                    <input type="number" id="ic-periodos" step="1">
                </div>
                <button onclick="calcularInteresCompuesto()">Calcular Interés</button>
                <div id="ic-result" class="result hidden"></div>
                <div class="explanation">
                    <p>El interés compuesto es el interés calculado sobre el capital inicial más los intereses acumulados de períodos anteriores.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>I = Interés compuesto</li>
                        <li>P = Capital inicial</li>
                        <li>i = Tasa de interés por período (en decimal)</li>
                        <li>n = Número de períodos</li>
                    </ul>
                </div>
            </div>
            
            <!-- Monto con Interés Compuesto -->
            <div id="monto-interes-compuesto-form" class="form-content hidden">
                <h2>Monto con Interés Compuesto</h2>
                <p class="formula">M = P × (1 + i)<sup>n</sup></p>
                <div class="form-group">
                    <label for="mic-capital">Capital (P):</label>
                    <input type="number" id="mic-capital" step="0.01">
                </div>
                <div class="form-group">
                    <label for="mic-tasa">Tasa de interés por período (i):</label>
                    <input type="number" id="mic-tasa" step="0.0001">
                </div>
                <div class="form-group">
                    <label for="mic-periodos">Número de períodos (n):</label>
                    <input type="number" id="mic-periodos" step="1">
                </div>
                <button onclick="calcularMontoInteresCompuesto()">Calcular Monto</button>
                <div id="mic-result" class="result hidden"></div>
                <div class="explanation">
                    <p>El monto con interés compuesto es el capital inicial multiplicado por (1 más la tasa de interés) elevado al número de períodos.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>M = Monto final</li>
                        <li>P = Capital inicial</li>
                        <li>i = Tasa de interés por período (en decimal)</li>
                        <li>n = Número de períodos</li>
                    </ul>
                </div>
            </div>
            
            <!-- Capital con Interés Compuesto -->
            <div id="capital-interes-compuesto-form" class="form-content hidden">
                <h2>Capital con Interés Compuesto</h2>
                <p class="formula">P = M / (1 + i)<sup>n</sup></p>
                <div class="form-group">
                    <label for="cic-monto">Monto (M):</label>
                    <input type="number" id="cic-monto" step="0.01">
                </div>
                <div class="form-group">
                    <label for="cic-tasa">Tasa de interés por período (i):</label>
                    <input type="number" id="cic-tasa" step="0.0001">
                </div>
                <div class="form-group">
                    <label for="cic-periodos">Número de períodos (n):</label>
                    <input type="number" id="cic-periodos" step="1">
                </div>
                <button onclick="calcularCapitalInteresCompuesto()">Calcular Capital</button>
                <div id="cic-result" class="result hidden"></div>
                <div class="explanation">
                    <p>El capital inicial se calcula dividiendo el monto final entre (1 más la tasa de interés) elevado al número de períodos.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>P = Capital inicial</li>
                        <li>M = Monto final</li>
                        <li>i = Tasa de interés por período (en decimal)</li>
                        <li>n = Número de períodos</li>
                    </ul>
                </div>
            </div>
            
            <!-- Tasa de Interés Compuesto -->
            <div id="tasa-interes-compuesto-form" class="form-content hidden">
                <h2>Tasa de Interés Compuesto</h2>
                <p class="formula">i = (M / P)<sup>1/n</sup> - 1</p>
                <div class="form-group">
                    <label for="tic-monto">Monto (M):</label>
                    <input type="number" id="tic-monto" step="0.01">
                </div>
                <div class="form-group">
                    <label for="tic-capital">Capital (P):</label>
                    <input type="number" id="tic-capital" step="0.01">
                </div>
                <div class="form-group">
                    <label for="tic-periodos">Número de períodos (n):</label>
                    <input type="number" id="tic-periodos" step="1">
                </div>
                <button onclick="calcularTasaInteresCompuesto()">Calcular Tasa</button>
                <div id="tic-result" class="result hidden"></div>
                <div class="explanation">
                    <p>La tasa de interés por período se calcula como la raíz n-ésima del cociente entre el monto y el capital, menos uno.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>i = Tasa de interés por período (en decimal)</li>
                        <li>M = Monto final</li>
                        <li>P = Capital inicial</li>
                        <li>n = Número de períodos</li>
                    </ul>
                </div>
            </div>
            
            <!-- Tiempo con Interés Compuesto -->
            <div id="tiempo-interes-compuesto-form" class="form-content hidden">
                <h2>Tiempo con Interés Compuesto</h2>
                <p class="formula">n = log(M / P) / log(1 + i)</p>
                <div class="form-group">
                    <label for="timeic-monto">Monto (M):</label>
                    <input type="number" id="timeic-monto" step="0.01">
                </div>
                <div class="form-group">
                    <label for="timeic-capital">Capital (P):</label>
                    <input type="number" id="timeic-capital" step="0.01">
                </div>
                <div class="form-group">
                    <label for="timeic-tasa">Tasa de interés por período (i):</label>
                    <input type="number" id="timeic-tasa" step="0.0001">
                </div>
                <button onclick="calcularTiempoInteresCompuesto()">Calcular Tiempo</button>
                <div id="timeic-result" class="result hidden"></div>
                <div class="explanation">
                    <p>El tiempo necesario se calcula como el logaritmo del cociente entre el monto y el capital, dividido por el logaritmo de (1 más la tasa de interés).</p>
                    <p>Donde:</p>
                    <ul>
                        <li>n = Número de períodos</li>
                        <li>M = Monto final</li>
                        <li>P = Capital inicial</li>
                        <li>i = Tasa de interés por período (en decimal)</li>
                    </ul>
                </div>
            </div>
            
            <!-- Descuento Simple -->
            <div id="descuento-simple-form" class="form-content hidden">
                <h2>Descuento Simple</h2>
                <p class="formula">D = Vn × d × t</p>
                <div class="form-group">
                    <label for="ds-valor-nominal">Valor nominal (Vn):</label>
                    <input type="number" id="ds-valor-nominal" step="0.01">
                </div>
                <div class="form-group">
                    <label for="ds-tasa-descuento">Tasa de descuento (d):</label>
                    <input type="number" id="ds-tasa-descuento" step="0.0001">
                </div>
                <div class="form-group">
                    <label for="ds-tiempo">Tiempo (t):</label>
                    <input type="number" id="ds-tiempo" step="0.01">
                </div>
                <div class="form-group">
                    <label for="ds-tiempo-unidad">Unidad de tiempo:</label>
                    <select id="ds-tiempo-unidad">
                        <option value="anios">Años</option>
                        <option value="meses">Meses</option>
                        <option value="dias">Días</option>
                    </select>
                </div>
                <button onclick="calcularDescuentoSimple()">Calcular Descuento</button>
                <div id="ds-result" class="result hidden"></div>
                <div class="explanation">
                    <p>El descuento simple es la reducción aplicada a un valor futuro para obtener su valor presente.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>D = Descuento</li>
                        <li>Vn = Valor nominal (valor futuro)</li>
                        <li>d = Tasa de descuento (en decimal)</li>
                        <li>t = Tiempo</li>
                    </ul>
                </div>
            </div>
            
            <!-- Tasa de Descuento -->
            <div id="tasa-descuento-form" class="form-content hidden">
                <h2>Tasa de Descuento</h2>
                <p class="formula">d = D / (Vn × t)</p>
                <div class="form-group">
                    <label for="td-descuento">Descuento (D):</label>
                    <input type="number" id="td-descuento" step="0.01">
                </div>
                <div class="form-group">
                    <label for="td-valor-nominal">Valor nominal (Vn):</label>
                    <input type="number" id="td-valor-nominal" step="0.01">
                </div>
                <div class="form-group">
                    <label for="td-tiempo">Tiempo (t):</label>
                    <input type="number" id="td-tiempo" step="0.01">
                </div>
                <div class="form-group">
                    <label for="td-tiempo-unidad">Unidad de tiempo:</label>
                    <select id="td-tiempo-unidad">
                        <option value="anios">Años</option>
                        <option value="meses">Meses</option>
                        <option value="dias">Días</option>
                    </select>
                </div>
                <button onclick="calcularTasaDescuento()">Calcular Tasa</button>
                <div id="td-result" class="result hidden"></div>
                <div class="explanation">
                    <p>La tasa de descuento es el descuento dividido por el producto del valor nominal y el tiempo.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>d = Tasa de descuento (en decimal)</li>
                        <li>D = Descuento</li>
                        <li>Vn = Valor nominal (valor futuro)</li>
                        <li>t = Tiempo</li>
                    </ul>
                </div>
            </div>
            
            <!-- Valor Presente -->
            <div id="valor-presente-form" class="form-content hidden">
                <h2>Valor Presente</h2>
                <p class="formula">VP = VF / (1 + i)<sup>n</sup></p>
                <div class="form-group">
                    <label for="vp-valor-futuro">Valor futuro (VF):</label>
                    <input type="number" id="vp-valor-futuro" step="0.01">
                </div>
                <div class="form-group">
                    <label for="vp-tasa">Tasa de interés (i):</label>
                    <input type="number" id="vp-tasa" step="0.0001">
                </div>
                <div class="form-group">
                    <label for="vp-periodos">Número de períodos (n):</label>
                    <input type="number" id="vp-periodos" step="1">
                </div>
                <button onclick="calcularValorPresente()">Calcular Valor Presente</button>
                <div id="vp-result" class="result hidden"></div>
                <div class="explanation">
                    <p>El valor presente es el valor actual de una cantidad futura, descontada a una tasa de interés específica.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>VP = Valor presente</li>
                        <li>VF = Valor futuro</li>
                        <li>i = Tasa de interés por período (en decimal)</li>
                        <li>n = Número de períodos</li>
                    </ul>
                </div>
            </div>
            
            <!-- Valor Futuro -->
            <div id="valor-futuro-form" class="form-content hidden">
                <h2>Valor Futuro</h2>
                <p class="formula">VF = VP × (1 + i)<sup>n</sup></p>
                <div class="form-group">
                    <label for="vf-valor-presente">Valor presente (VP):</label>
                    <input type="number" id="vf-valor-presente" step="0.01">
                </div>
                <div class="form-group">
                    <label for="vf-tasa">Tasa de interés (i):</label>
                    <input type="number" id="vf-tasa" step="0.0001">
                </div>
                <div class="form-group">
                    <label for="vf-periodos">Número de períodos (n):</label>
                    <input type="number" id="vf-periodos" step="1">
                </div>
                <button onclick="calcularValorFuturo()">Calcular Valor Futuro</button>
                <div id="vf-result" class="result hidden"></div>
                <div class="explanation">
                    <p>El valor futuro es el valor de un activo en una fecha futura basado en una tasa de crecimiento asumida.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>VF = Valor futuro</li>
                        <li>VP = Valor presente</li>
                        <li>i = Tasa de interés por período (en decimal)</li>
                        <li>n = Número de períodos</li>
                    </ul>
                </div>
            </div>
            
            <!-- Ecuación de Valor -->
            <div id="ecuacion-valor-form" class="form-content hidden">
                <h2>Ecuación de Valor</h2>
                <p class="formula">Σ Pagos = Σ Obligaciones (en fecha focal)</p>
                <div class="form-group">
                    <label for="ev-tasa">Tasa de interés (i):</label>
                    <input type="number" id="ev-tasa" step="0.0001">
                </div>
                <div class="form-group">
                    <label for="ev-fecha-focal">Fecha focal (días desde hoy):</label>
                    <input type="number" id="ev-fecha-focal" step="1">
                </div>
                
                <h3>Pagos</h3>
                <div id="ev-pagos-container" class="payment-container">
                    <div class="payment-row">
                        <input type="number" class="ev-pago-monto" placeholder="Monto" step="0.01">
                        <input type="number" class="ev-pago-dias" placeholder="Días desde hoy" step="1">
                        <button class="remove-payment" onclick="removePaymentRow(this)">×</button>
                    </div>
                </div>
                <button class="add-payment" onclick="addPaymentRow('ev-pagos-container')">+ Agregar Pago</button>
                
                <h3>Obligaciones</h3>
                <div id="ev-obligaciones-container" class="payment-container">
                    <div class="payment-row">
                        <input type="number" class="ev-obligacion-monto" placeholder="Monto" step="0.01">
                        <input type="number" class="ev-obligacion-dias" placeholder="Días desde hoy" step="1">
                        <button class="remove-payment" onclick="removePaymentRow(this)">×</button>
                    </div>
                </div>
                <button class="add-payment" onclick="addPaymentRow('ev-obligaciones-container')">+ Agregar Obligación</button>
                
                <button onclick="calcularEcuacionValor()">Calcular Ecuación de Valor</button>
                <div id="ev-result" class="result hidden"></div>
                <div class="explanation">
                    <p>La ecuación de valor es una igualdad que establece que la suma de los pagos debe ser igual a la suma de las obligaciones, todas valuadas en una misma fecha llamada fecha focal.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>Pagos = Montos que se pagan en diferentes fechas</li>
                        <li>Obligaciones = Montos que se deben en diferentes fechas</li>
                        <li>Fecha focal = Fecha de comparación para valuar todos los montos</li>
                        <li>i = Tasa de interés para los cálculos</li>
                    </ul>
                </div>
            </div>
            
            <!-- Pagos Parciales -->
            <div id="pagos-parciales-form" class="form-content hidden">
                <h2>Pagos Parciales</h2>
                <p class="formula">Método de Saldos Insolutos</p>
                <div class="form-group">
                    <label for="pp-capital">Capital inicial (P):</label>
                    <input type="number" id="pp-capital" step="0.01">
                </div>
                <div class="form-group">
                    <label for="pp-tasa">Tasa de interés (i):</label>
                    <input type="number" id="pp-tasa" step="0.0001">
                </div>
                <div class="form-group">
                    <label for="pp-plazo">Plazo total (días):</label>
                    <input type="number" id="pp-plazo" step="1">
                </div>
                
                <h3>Pagos Parciales</h3>
                <div id="pp-pagos-container" class="payment-container">
                    <div class="payment-row">
                        <input type="number" class="pp-pago-monto" placeholder="Monto" step="0.01">
                        <input type="number" class="pp-pago-dias" placeholder="Días desde inicio" step="1">
                        <button class="remove-payment" onclick="removePaymentRow(this)">×</button>
                    </div>
                </div>
                <button class="add-payment" onclick="addPaymentRow('pp-pagos-container')">+ Agregar Pago</button>
                
                <button onclick="calcularPagosParciales()">Calcular Saldo Final</button>
                <div id="pp-result" class="result hidden"></div>
                <div class="explanation">
                    <p>El método de pagos parciales (o saldos insolutos) calcula el saldo pendiente considerando que cada pago se aplica primero a los intereses generados hasta esa fecha y luego al capital.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>P = Capital inicial del préstamo</li>
                        <li>i = Tasa de interés diaria (tasa anual / 360 o 365)</li>
                        <li>Pagos parciales = Abonos realizados antes del plazo total</li>
                        <li>Saldo final = Capital pendiente al final del plazo</li>
                    </ul>
                </div>
            </div>
            
            <!-- Regla de Saldos -->
            <div id="regla-saldos-form" class="form-content hidden">
                <h2>Regla de Saldos</h2>
                <p class="formula">Interés = Σ (Saldo × Días × Tasa diaria)</p>
                <div class="form-group">
                    <label for="rs-tasa">Tasa de interés anual (i):</label>
                    <input type="number" id="rs-tasa" step="0.0001">
                </div>
                
                <h3>Movimientos</h3>
                <div id="rs-movimientos-container" class="payment-container">
                    <div class="payment-row">
                        <input type="number" class="rs-movimiento-dias" placeholder="Días desde inicio" step="1">
                        <input type="number" class="rs-movimiento-monto" placeholder="Monto (+depósito/-retiro)" step="0.01">
                        <button class="remove-payment" onclick="removePaymentRow(this)">×</button>
                    </div>
                </div>
                <button class="add-payment" onclick="addPaymentRow('rs-movimientos-container')">+ Agregar Movimiento</button>
                
                <button onclick="calcularReglaSaldos()">Calcular Interés</button>
                <div id="rs-result" class="result hidden"></div>
                <div class="explanation">
                    <p>La regla de saldos calcula el interés generado por una cuenta considerando los saldos diarios y el tiempo que permanecieron sin cambios.</p>
                    <p>Donde:</p>
                    <ul>
                        <li>Saldo = Cantidad en la cuenta en un período</li>
                        <li>Días = Días que permaneció ese saldo</li>
                        <li>Tasa diaria = Tasa anual / 360 o 365 días</li>
                        <li>Interés = Suma de (Saldo × Días × Tasa diaria) para todos los períodos</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Función para cambiar entre formularios
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', function() {
                // Remover clase active de todos los items
                document.querySelectorAll('.menu-item').forEach(i => {
                    i.classList.remove('active');
                });
                
                // Agregar clase active al item clickeado
                this.classList.add('active');
                
                // Ocultar todos los formularios
                document.querySelectorAll('.form-content').forEach(form => {
                    form.classList.add('hidden');
                });
                
                // Mostrar el formulario correspondiente
                const formId = this.getAttribute('data-form') + '-form';
                document.getElementById(formId).classList.remove('hidden');
            });
        });
        
        // Funciones para manejar filas de pagos
        function addPaymentRow(containerId) {
            const container = document.getElementById(containerId);
            const newRow = document.createElement('div');
            newRow.className = 'payment-row';
            
            if (containerId === 'rs-movimientos-container') {
                newRow.innerHTML = `
                    <input type="number" class="rs-movimiento-dias" placeholder="Días desde inicio" step="1">
                    <input type="number" class="rs-movimiento-monto" placeholder="Monto (+depósito/-retiro)" step="0.01">
                    <button class="remove-payment" onclick="removePaymentRow(this)">×</button>
                `;
            } else if (containerId === 'ev-pagos-container') {
                newRow.innerHTML = `
                    <input type="number" class="ev-pago-monto" placeholder="Monto" step="0.01">
                    <input type="number" class="ev-pago-dias" placeholder="Días desde hoy" step="1">
                    <button class="remove-payment" onclick="removePaymentRow(this)">×</button>
                `;
            } else if (containerId === 'ev-obligaciones-container') {
                newRow.innerHTML = `
                    <input type="number" class="ev-obligacion-monto" placeholder="Monto" step="0.01">
                    <input type="number" class="ev-obligacion-dias" placeholder="Días desde hoy" step="1">
                    <button class="remove-payment" onclick="removePaymentRow(this)">×</button>
                `;
            } else if (containerId === 'pp-pagos-container') {
                newRow.innerHTML = `
                    <input type="number" class="pp-pago-monto" placeholder="Monto" step="0.01">
                    <input type="number" class="pp-pago-dias" placeholder="Días desde inicio" step="1">
                    <button class="remove-payment" onclick="removePaymentRow(this)">×</button>
                `;
            }
            
            container.appendChild(newRow);
        }
        
        function removePaymentRow(button) {
            const row = button.parentNode;
            row.parentNode.removeChild(row);
        }
        
        // Funciones para convertir tiempo según unidad seleccionada
        function convertirTiempo(tiempo, unidad) {
            switch(unidad) {
                case 'meses':
                    return tiempo / 12;
                case 'dias':
                    return tiempo / 360; // Año comercial de 360 días
                default: // años
                    return tiempo;
            }
        }
        
        // Funciones de cálculo
        
        function calcularInteresSimple() {
            const capital = parseFloat(document.getElementById('is-capital').value);
            const tasa = parseFloat(document.getElementById('is-tasa').value) / 100;
            const tiempo = parseFloat(document.getElementById('is-tiempo').value);
            const unidad = document.getElementById('is-tiempo-unidad').value;
            
            const tiempoAnios = convertirTiempo(tiempo, unidad);
            const interes = capital * tasa * tiempoAnios;
            
            const resultDiv = document.getElementById('is-result');
            resultDiv.innerHTML = `
                <p><strong>Interés Simple:</strong> $${interes.toFixed(2)}</p>
                <p>Fórmula aplicada: I = P × i × t = ${capital} × ${tasa} × ${tiempoAnios.toFixed(4)} = ${interes.toFixed(2)}</p>
                <p>Tiempo ingresado: ${tiempo} ${unidad} = ${tiempoAnios.toFixed(4)} años</p>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        function calcularMontoInteresSimple() {
            const capital = parseFloat(document.getElementById('mis-capital').value);
            const tasa = parseFloat(document.getElementById('mis-tasa').value) / 100;
            const tiempo = parseFloat(document.getElementById('mis-tiempo').value);
            const unidad = document.getElementById('mis-tiempo-unidad').value;
            
            const tiempoAnios = convertirTiempo(tiempo, unidad);
            const monto = capital * (1 + tasa * tiempoAnios);
            
            const resultDiv = document.getElementById('mis-result');
            resultDiv.innerHTML = `
                <p><strong>Monto con Interés Simple:</strong> $${monto.toFixed(2)}</p>
                <p>Fórmula aplicada: M = P × (1 + i × t) = ${capital} × (1 + ${tasa} × ${tiempoAnios.toFixed(4)}) = ${monto.toFixed(2)}</p>
                <p>Tiempo ingresado: ${tiempo} ${unidad} = ${tiempoAnios.toFixed(4)} años</p>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        function calcularInteresCompuesto() {
            const capital = parseFloat(document.getElementById('ic-capital').value);
            const tasa = parseFloat(document.getElementById('ic-tasa').value) / 100;
            const periodos = parseFloat(document.getElementById('ic-periodos').value);
            
            const interes = capital * (Math.pow(1 + tasa, periodos) - 1);
            
            const resultDiv = document.getElementById('ic-result');
            resultDiv.innerHTML = `
                <p><strong>Interés Compuesto:</strong> $${interes.toFixed(2)}</p>
                <p><strong>Monto Final:</strong> $${(capital + interes).toFixed(2)}</p>
                <p>Fórmula aplicada: I = P × [(1 + i)<sup>n</sup> - 1] = ${capital} × [(1 + ${tasa})<sup>${periodos}</sup> - 1] = ${interes.toFixed(2)}</p>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        function calcularMontoInteresCompuesto() {
            const capital = parseFloat(document.getElementById('mic-capital').value);
            const tasa = parseFloat(document.getElementById('mic-tasa').value) / 100;
            const periodos = parseFloat(document.getElementById('mic-periodos').value);
            
            const monto = capital * Math.pow(1 + tasa, periodos);
            
            const resultDiv = document.getElementById('mic-result');
            resultDiv.innerHTML = `
                <p><strong>Monto con Interés Compuesto:</strong> $${monto.toFixed(2)}</p>
                <p>Fórmula aplicada: M = P × (1 + i)<sup>n</sup> = ${capital} × (1 + ${tasa})<sup>${periodos}</sup> = ${monto.toFixed(2)}</p>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        function calcularCapitalInteresCompuesto() {
            const monto = parseFloat(document.getElementById('cic-monto').value);
            const tasa = parseFloat(document.getElementById('cic-tasa').value) / 100;
            const periodos = parseFloat(document.getElementById('cic-periodos').value);
            
            const capital = monto / Math.pow(1 + tasa, periodos);
            
            const resultDiv = document.getElementById('cic-result');
            resultDiv.innerHTML = `
                <p><strong>Capital Inicial:</strong> $${capital.toFixed(2)}</p>
                <p>Fórmula aplicada: P = M / (1 + i)<sup>n</sup> = ${monto} / (1 + ${tasa})<sup>${periodos}</sup> = ${capital.toFixed(2)}</p>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        function calcularTasaInteresCompuesto() {
            const monto = parseFloat(document.getElementById('tic-monto').value);
            const capital = parseFloat(document.getElementById('tic-capital').value);
            const periodos = parseFloat(document.getElementById('tic-periodos').value);
            
            const tasa = Math.pow(monto / capital, 1 / periodos) - 1;
            
            const resultDiv = document.getElementById('tic-result');
            resultDiv.innerHTML = `
                <p><strong>Tasa de Interés por Período:</strong> ${(tasa * 100).toFixed(4)}%</p>
                <p><strong>Tasa Anual (si el período es anual):</strong> ${(tasa * 100).toFixed(4)}%</p>
                <p>Fórmula aplicada: i = (M / P)<sup>1/n</sup> - 1 = (${monto} / ${capital})<sup>1/${periodos}</sup> - 1 = ${tasa.toFixed(6)}</p>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        function calcularTiempoInteresCompuesto() {
            const monto = parseFloat(document.getElementById('timeic-monto').value);
            const capital = parseFloat(document.getElementById('timeic-capital').value);
            const tasa = parseFloat(document.getElementById('timeic-tasa').value) / 100;
            
            const tiempo = Math.log(monto / capital) / Math.log(1 + tasa);
            
            const resultDiv = document.getElementById('timeic-result');
            resultDiv.innerHTML = `
                <p><strong>Tiempo necesario:</strong> ${tiempo.toFixed(2)} períodos</p>
                <p>Fórmula aplicada: n = log(M / P) / log(1 + i) = log(${monto} / ${capital}) / log(1 + ${tasa}) = ${tiempo.toFixed(2)}</p>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        function calcularDescuentoSimple() {
            const valorNominal = parseFloat(document.getElementById('ds-valor-nominal').value);
            const tasaDescuento = parseFloat(document.getElementById('ds-tasa-descuento').value) / 100;
            const tiempo = parseFloat(document.getElementById('ds-tiempo').value);
            const unidad = document.getElementById('ds-tiempo-unidad').value;
            
            const tiempoAnios = convertirTiempo(tiempo, unidad);
            const descuento = valorNominal * tasaDescuento * tiempoAnios;
            
            const resultDiv = document.getElementById('ds-result');
            resultDiv.innerHTML = `
                <p><strong>Descuento Simple:</strong> $${descuento.toFixed(2)}</p>
                <p><strong>Valor Actual:</strong> $${(valorNominal - descuento).toFixed(2)}</p>
                <p>Fórmula aplicada: D = Vn × d × t = ${valorNominal} × ${tasaDescuento} × ${tiempoAnios.toFixed(4)} = ${descuento.toFixed(2)}</p>
                <p>Tiempo ingresado: ${tiempo} ${unidad} = ${tiempoAnios.toFixed(4)} años</p>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        function calcularTasaDescuento() {
            const descuento = parseFloat(document.getElementById('td-descuento').value);
            const valorNominal = parseFloat(document.getElementById('td-valor-nominal').value);
            const tiempo = parseFloat(document.getElementById('td-tiempo').value);
            const unidad = document.getElementById('td-tiempo-unidad').value;
            
            const tiempoAnios = convertirTiempo(tiempo, unidad);
            const tasaDescuento = descuento / (valorNominal * tiempoAnios);
            
            const resultDiv = document.getElementById('td-result');
            resultDiv.innerHTML = `
                <p><strong>Tasa de Descuento:</strong> ${(tasaDescuento * 100).toFixed(4)}%</p>
                <p>Fórmula aplicada: d = D / (Vn × t) = ${descuento} / (${valorNominal} × ${tiempoAnios.toFixed(4)}) = ${tasaDescuento.toFixed(6)}</p>
                <p>Tiempo ingresado: ${tiempo} ${unidad} = ${tiempoAnios.toFixed(4)} años</p>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        function calcularValorPresente() {
            const valorFuturo = parseFloat(document.getElementById('vp-valor-futuro').value);
            const tasa = parseFloat(document.getElementById('vp-tasa').value) / 100;
            const periodos = parseFloat(document.getElementById('vp-periodos').value);
            
            const valorPresente = valorFuturo / Math.pow(1 + tasa, periodos);
            
            const resultDiv = document.getElementById('vp-result');
            resultDiv.innerHTML = `
                <p><strong>Valor Presente:</strong> $${valorPresente.toFixed(2)}</p>
                <p>Fórmula aplicada: VP = VF / (1 + i)<sup>n</sup> = ${valorFuturo} / (1 + ${tasa})<sup>${periodos}</sup> = ${valorPresente.toFixed(2)}</p>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        function calcularValorFuturo() {
            const valorPresente = parseFloat(document.getElementById('vf-valor-presente').value);
            const tasa = parseFloat(document.getElementById('vf-tasa').value) / 100;
            const periodos = parseFloat(document.getElementById('vf-periodos').value);
            
            const valorFuturo = valorPresente * Math.pow(1 + tasa, periodos);
            
            const resultDiv = document.getElementById('vf-result');
            resultDiv.innerHTML = `
                <p><strong>Valor Futuro:</strong> $${valorFuturo.toFixed(2)}</p>
                <p>Fórmula aplicada: VF = VP × (1 + i)<sup>n</sup> = ${valorPresente} × (1 + ${tasa})<sup>${periodos}</sup> = ${valorFuturo.toFixed(2)}</p>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        // Nueva función para Ecuación de Valor
        function calcularEcuacionValor() {
            const tasa = parseFloat(document.getElementById('ev-tasa').value) / 100;
            const fechaFocal = parseFloat(document.getElementById('ev-fecha-focal').value);
            
            // Obtener pagos
            const pagos = [];
            const pagosRows = document.getElementById('ev-pagos-container').querySelectorAll('.payment-row');
            pagosRows.forEach(row => {
                const monto = parseFloat(row.querySelector('.ev-pago-monto').value);
                const dias = parseFloat(row.querySelector('.ev-pago-dias').value);
                if (!isNaN(monto) && !isNaN(dias)) {
                    pagos.push({ monto, dias });
                }
            });
            
            // Obtener obligaciones
            const obligaciones = [];
            const obligacionesRows = document.getElementById('ev-obligaciones-container').querySelectorAll('.payment-row');
            obligacionesRows.forEach(row => {
                const monto = parseFloat(row.querySelector('.ev-obligacion-monto').value);
                const dias = parseFloat(row.querySelector('.ev-obligacion-dias').value);
                if (!isNaN(monto) && !isNaN(dias)) {
                    obligaciones.push({ monto, dias });
                }
            });
            
            // Calcular valor de pagos en fecha focal
            let valorPagos = 0;
            pagos.forEach(pago => {
                const diasDiferencia = fechaFocal - pago.dias;
                const periodos = diasDiferencia / 360; // Año comercial
                valorPagos += pago.monto * Math.pow(1 + tasa, periodos);
            });
            
            // Calcular valor de obligaciones en fecha focal
            let valorObligaciones = 0;
            obligaciones.forEach(obligacion => {
                const diasDiferencia = fechaFocal - obligacion.dias;
                const periodos = diasDiferencia / 360; // Año comercial
                valorObligaciones += obligacion.monto * Math.pow(1 + tasa, periodos);
            });
            
            // Calcular diferencia
            const diferencia = valorPagos - valorObligaciones;
            
            const resultDiv = document.getElementById('ev-result');
            resultDiv.innerHTML = `
                <p><strong>Valor de Pagos en Fecha Focal:</strong> $${valorPagos.toFixed(2)}</p>
                <p><strong>Valor de Obligaciones en Fecha Focal:</strong> $${valorObligaciones.toFixed(2)}</p>
                <p><strong>Diferencia:</strong> $${diferencia.toFixed(2)}</p>
                ${diferencia >= 0 ? 
                    `<p>Los pagos cubren las obligaciones con un excedente de $${diferencia.toFixed(2)}</p>` : 
                    `<p>Los pagos no cubren las obligaciones, faltan $${Math.abs(diferencia).toFixed(2)}</p>`}
                <h4>Detalle de Cálculos:</h4>
                <p><strong>Pagos:</strong></p>
                <ul>
                    ${pagos.map(pago => {
                        const diasDiferencia = fechaFocal - pago.dias;
                        const periodos = diasDiferencia / 360;
                        const valor = pago.monto * Math.pow(1 + tasa, periodos);
                        return `<li>$${pago.monto.toFixed(2)} en día ${pago.dias} → $${valor.toFixed(2)} en fecha focal</li>`;
                    }).join('')}
                </ul>
                <p><strong>Obligaciones:</strong></p>
                <ul>
                    ${obligaciones.map(obligacion => {
                        const diasDiferencia = fechaFocal - obligacion.dias;
                        const periodos = diasDiferencia / 360;
                        const valor = obligacion.monto * Math.pow(1 + tasa, periodos);
                        return `<li>$${obligacion.monto.toFixed(2)} en día ${obligacion.dias} → $${valor.toFixed(2)} en fecha focal</li>`;
                    }).join('')}
                </ul>
            `;
            resultDiv.classList.remove('hidden');
        }
        
        // Nueva función para Pagos Parciales (Método de Saldos Insolutos)
        function calcularPagosParciales() {
            const capital = parseFloat(document.getElementById('pp-capital').value);
            const tasaAnual = parseFloat(document.getElementById('pp-tasa').value) / 100;
            const plazoTotal = parseFloat(document.getElementById('pp-plazo').value);
            const tasaDiaria = tasaAnual / 360; // Tasa diaria usando año comercial
            
            // Obtener pagos parciales
            const pagos = [];
            const pagosRows = document.getElementById('pp-pagos-container').querySelectorAll('.payment-row');
            pagosRows.forEach(row => {
                const monto = parseFloat(row.querySelector('.pp-pago-monto').value);
                const dias = parseFloat(row.querySelector('.pp-pago-dias').value);
                if (!isNaN(monto) && !isNaN(dias)) {
                    pagos.push({ monto, dias });
                }
            });
            
            // Ordenar pagos por fecha
            pagos.sort((a, b) => a.dias - b.dias);
            
            // Procesar pagos
            let saldo = capital;
            let totalIntereses = 0;
            let diasAnteriores = 0;
            let detalle = '<h4>Detalle de Pagos:</h4><table border="1" style="width:100%; border-collapse:collapse; margin-top:10px;"><tr><th>Día</th><th>Saldo Inicial</th><th>Interés</th><th>Pago</th><th>Capital Amortizado</th><th>Saldo Final</th></tr>';
            
            for (let i = 0; i < pagos.length; i++) {
                const pago = pagos[i];
                const diasTranscurridos = pago.dias - diasAnteriores;
                const interes = saldo * tasaDiaria * diasTranscurridos;
                totalIntereses += interes;
                
                let capitalAmortizado = 0;
                if (pago.monto > interes) {
                    capitalAmortizado = pago.monto - interes;
                    saldo -= capitalAmortizado;
                } else {
                    // El pago no cubre los intereses, se acumulan
                    saldo += (interes - pago.monto);
                    capitalAmortizado = 0;
                }
                
                detalle += `<tr>
                    <td>${pago.dias}</td>
                    <td>$${saldo.toFixed(2)}</td>
                    <td>$${interes.toFixed(2)}</td>
                    <td>$${pago.monto.toFixed(2)}</td>
                    <td>$${capitalAmortizado.toFixed(2)}</td>
                    <td>$${saldo.toFixed(2)}</td>
                </tr>`;
                
                diasAnteriores = pago.dias;
            }
            
            // Calcular intereses del período final
            const diasFinal = plazoTotal - diasAnteriores;
            const interesFinal = saldo * tasaDiaria * diasFinal;
            totalIntereses += interesFinal;
            
            detalle += `<tr>
                <td>${plazoTotal}</td>
                <td>$${saldo.toFixed(2)}</td>
                <td>$${interesFinal.toFixed(2)}</td>
                <td>$${saldo.toFixed(2)}</td>
                <td>$${saldo.toFixed(2)}</td>
                <td>$0.00</td>
            </tr></table>`;
            
            const resultDiv = document.getElementById('pp-result');
            resultDiv.innerHTML = `
                <p><strong>Capital Inicial:</strong> $${capital.toFixed(2)}</p>
                <p><strong>Total de Intereses:</strong> $${totalIntereses.toFixed(2)}</p>
                <p><strong>Total Pagado:</strong> $${(capital + totalIntereses).toFixed(2)}</p>
                <p><strong>Saldo Final:</strong> $${saldo.toFixed(2)}</p>
                ${detalle}
            `;
            resultDiv.classList.remove('hidden');
        }
        
        // Nueva función para Regla de Saldos
        function calcularReglaSaldos() {
            const tasaAnual = parseFloat(document.getElementById('rs-tasa').value) / 100;
            const tasaDiaria = tasaAnual / 360; // Tasa diaria usando año comercial
            
            // Obtener movimientos
            const movimientos = [];
            const movimientosRows = document.getElementById('rs-movimientos-container').querySelectorAll('.payment-row');
            movimientosRows.forEach(row => {
                const dias = parseFloat(row.querySelector('.rs-movimiento-dias').value);
                const monto = parseFloat(row.querySelector('.rs-movimiento-monto').value);
                if (!isNaN(monto) && !isNaN(dias)) {
                    movimientos.push({ dias, monto });
                }
            });
            
            // Ordenar movimientos por fecha
            movimientos.sort((a, b) => a.dias - b.dias);
            
            // Procesar movimientos
            let saldo = 0;
            let diasAnteriores = 0;
            let totalInteres = 0;
            let detalle = '<h4>Detalle de Movimientos:</h4><table border="1" style="width:100%; border-collapse:collapse; margin-top:10px;"><tr><th>Días</th><th>Movimiento</th><th>Saldo</th><th>Días Acumulados</th><th>Interés</th></tr>';
            
            for (let i = 0; i < movimientos.length; i++) {
                const movimiento = movimientos[i];
                const diasTranscurridos = movimiento.dias - diasAnteriores;
                
                // Calcular interés del período anterior
                const interes = saldo * tasaDiaria * diasTranscurridos;
                totalInteres += interes;
                
                detalle += `<tr>
                    <td>${movimiento.dias}</td>
                    <td>${movimiento.monto >= 0 ? '+' : ''}$${movimiento.monto.toFixed(2)}</td>
                    <td>$${saldo.toFixed(2)}</td>
                    <td>${diasTranscurridos}</td>
                    <td>$${interes.toFixed(2)}</td>
                </tr>`;
                
                // Actualizar saldo
                saldo += movimiento.monto;
                diasAnteriores = movimiento.dias;
            }
            
            detalle += '</table>';
            
            const resultDiv = document.getElementById('rs-result');
            resultDiv.innerHTML = `
                <p><strong>Interés Total Generado:</strong> $${totalInteres.toFixed(2)}</p>
                <p><strong>Saldo Final:</strong> $${saldo.toFixed(2)}</p>
                ${detalle}
            `;
            resultDiv.classList.remove('hidden');
        }
    </script>
</body>
</html>
